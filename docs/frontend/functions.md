# Frontend Functions å‰ç«¯åŠŸèƒ½è¯´æ˜

## ç›®å½•
- [åº”ç”¨æ¶æ„](#åº”ç”¨æ¶æ„)
- [è·¯ç”±ç³»ç»Ÿ](#è·¯ç”±ç³»ç»Ÿ)
- [é¡µé¢æµç¨‹](#é¡µé¢æµç¨‹)
- [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
- [çŠ¶æ€ç®¡ç†](#çŠ¶æ€ç®¡ç†)

---

## åº”ç”¨æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React 18 + TypeScript
- **è·¯ç”±**: React Router v6
- **æ„å»ºå·¥å…·**: Vite
- **çŠ¶æ€ç®¡ç†**: React Context + Hooks

### ç›®å½•ç»“æ„
```
frontend/src/
â”œâ”€â”€ main.tsx                          # åº”ç”¨å…¥å£
â”œâ”€â”€ router.tsx                        # è·¯ç”±é…ç½®
â”œâ”€â”€ styles.css                        # å…¨å±€æ ·å¼
â”œâ”€â”€ components/
â”‚   â””â”€â”€ header/                       # å…¨å±€ç»„ä»¶
â”‚       â”œâ”€â”€ Header.tsx                # é¡¶éƒ¨å¯¼èˆªæ 
â”‚       â”œâ”€â”€ Header.css                # å¯¼èˆªæ æ ·å¼
â”‚       â””â”€â”€ index.ts
â””â”€â”€ modules/
    â”œâ”€â”€ auth/                         # è®¤è¯æ¨¡å—
    â”‚   â”œâ”€â”€ LoginPage.tsx             # ç™»å½•é¡µé¢
    â”‚   â”œâ”€â”€ SignupPage.tsx            # æ³¨å†Œé¡µé¢
    â”‚   â”œâ”€â”€ AuthShell.tsx             # è®¤è¯é¡µé¢å¤–å£³
    â”‚   â”œâ”€â”€ api/authApi.ts            # è®¤è¯API
    â”‚   â”œâ”€â”€ session/                  # ä¼šè¯ç®¡ç†
    â”‚   â”‚   â”œâ”€â”€ AuthSessionContext.tsx
    â”‚   â”‚   â””â”€â”€ tokenStore.ts
    â”‚   â””â”€â”€ components/
    â”‚       â””â”€â”€ AuthGuards.tsx        # è·¯ç”±å®ˆå«
    â”œâ”€â”€ home/                         # é¦–é¡µæ¨¡å—
    â”‚   â”œâ”€â”€ HomePage.tsx              # é¦–é¡µç»„ä»¶
    â”‚   â””â”€â”€ HomePage.css              # é¦–é¡µæ ·å¼
    â”œâ”€â”€ works/                        # ä½œå“æ¨¡å—
    â”‚   â”œâ”€â”€ WorksPage.tsx             # ä½œå“åˆ—è¡¨é¡µ
    â”‚   â”œâ”€â”€ WorkDetailPage.tsx        # ä½œå“è¯¦æƒ…é¡µ
    â”‚   â”œâ”€â”€ api/workApi.ts            # ä½œå“API
    â”‚   â”œâ”€â”€ hooks/                    # è‡ªå®šä¹‰Hooks
    â”‚   â”‚   â”œâ”€â”€ useWorksList.ts
    â”‚   â”‚   â””â”€â”€ useWorkDetail.ts
    â”‚   â””â”€â”€ components/
    â”‚       â”œâ”€â”€ WorksListPanel.tsx
    â”‚       â””â”€â”€ WorkDetailPanel.tsx
    â”œâ”€â”€ navigation/
    â”‚   â””â”€â”€ TestRouteSwitches.tsx     # æµ‹è¯•å¯¼èˆªç»„ä»¶
    â”œâ”€â”€ why/
    â”‚   â””â”€â”€ WhyPage.tsx               # Whyé¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰
    â””â”€â”€ about/
        â””â”€â”€ AboutPage.tsx             # Abouté¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰
```

---

## è·¯ç”±ç³»ç»Ÿ

### è·¯ç”±è¡¨

| è·¯å¾„ | ç»„ä»¶ | å®ˆå« | è¯´æ˜ |
|------|------|------|------|
| `/auth` | - | - | è‡ªåŠ¨é‡å®šå‘åˆ° `/auth/login` |
| `/auth/login` | `LoginPage` | `PublicOnlyRoute` | ç™»å½•é¡µï¼Œå·²ç™»å½•ç”¨æˆ·è®¿é—®ä¼šé‡å®šå‘åˆ° `/home` |
| `/auth/signup` | `SignupPage` | `PublicOnlyRoute` | æ³¨å†Œé¡µï¼Œå·²ç™»å½•ç”¨æˆ·è®¿é—®ä¼šé‡å®šå‘åˆ° `/home` |
| `/home` | `HomePage` | `ProtectedRoute` | é¦–é¡µï¼Œéœ€è¦ç™»å½•ï¼Œæ˜¾ç¤ºäº§å“ä»‹ç»å’Œå¿«é€Ÿå¯¼èˆª |
| `/works` | `WorksPage` | `ProtectedRoute` | ä½œå“åˆ—è¡¨é¡µï¼Œéœ€è¦ç™»å½• |
| `/works/:workId` | `WorkDetailPage` | `ProtectedRoute` | ä½œå“è¯¦æƒ…é¡µï¼Œéœ€è¦ç™»å½• |
| `/why` | `WhyPage` | - | Whyé¡µé¢ï¼ˆå…¬å¼€è®¿é—®ï¼‰ |
| `/about` | `AboutPage` | - | Abouté¡µé¢ï¼ˆå…¬å¼€è®¿é—®ï¼‰ |
| `*` | - | - | å…¶ä»–æ‰€æœ‰è·¯å¾„é‡å®šå‘åˆ° `/auth/login` |

### è·¯ç”±å®ˆå«

#### ProtectedRouteï¼ˆå—ä¿æŠ¤è·¯ç”±ï¼‰
- **ä½œç”¨**: ä¿æŠ¤éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„é¡µé¢
- **é€»è¾‘**:
  - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¤è¯ï¼ˆ`isAuthenticated`ï¼‰
  - å¦‚æœæœªè®¤è¯ï¼Œé‡å®šå‘åˆ° `/auth/login?return=<å½“å‰è·¯å¾„>` ï¼ˆä¿å­˜è¿”å›åœ°å€ï¼‰
  - å¦‚æœå·²è®¤è¯ï¼Œæ¸²æŸ“å­è·¯ç”±ç»„ä»¶

#### PublicOnlyRouteï¼ˆä»…å…¬å¼€è·¯ç”±ï¼‰
- **ä½œç”¨**: é˜²æ­¢å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•/æ³¨å†Œé¡µ
- **é€»è¾‘**:
  - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¤è¯
  - å¦‚æœå·²è®¤è¯ï¼Œé‡å®šå‘åˆ° `/home`
  - å¦‚æœæœªè®¤è¯ï¼Œæ¸²æŸ“å­è·¯ç”±ç»„ä»¶

---

## é¡µé¢æµç¨‹

### 1. é¦–æ¬¡è®¿é—®æµç¨‹

```
ç”¨æˆ·è®¿é—®ç½‘ç«™
    â†“
è®¿é—®æ ¹è·¯å¾„ (/)
    â†“
é‡å®šå‘åˆ° /auth/login
    â†“
æ˜¾ç¤ºç™»å½•é¡µé¢
```

### 2. ç™»å½•æµç¨‹

```
ç™»å½•é¡µé¢ (/auth/login)
    â†“
ç”¨æˆ·è¾“å…¥: Email + Password
    â†“
ç‚¹å‡» "Sign In" æŒ‰é’®
    â†“
è°ƒç”¨ POST /api/auth/login
    â†“
æˆåŠŸ: ä¿å­˜tokenå’Œç”¨æˆ·ä¿¡æ¯ â†’ é‡å®šå‘åˆ° /homeï¼ˆæˆ–returnå‚æ•°æŒ‡å®šçš„é¡µé¢ï¼‰
å¤±è´¥: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
```

**ç™»å½•é¡µé¢åŠŸèƒ½**:
- è¾“å…¥æ¡†ï¼š
  - Emailï¼ˆå¿…å¡«ï¼Œtype=emailï¼‰
  - Passwordï¼ˆå¿…å¡«ï¼Œtype=passwordï¼‰
- æŒ‰é’®ï¼š
  - "Sign In"ï¼šæäº¤ç™»å½•è¡¨å•
    - åŠ è½½ä¸­æ˜¾ç¤º "Signing In..."
    - ç¦ç”¨çŠ¶æ€ï¼šloading=trueæ—¶
- é“¾æ¥ï¼š
  - "Create account"ï¼šè·³è½¬åˆ° `/auth/signup`
- é”™è¯¯æ˜¾ç¤ºï¼šç™»å½•å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

**æ³¨æ„**: ç™»å½•ä»…æ”¯æŒé‚®ç®±ï¼Œä¸æ”¯æŒç”¨æˆ·åç™»å½•

### 3. æ³¨å†Œæµç¨‹

```
æ³¨å†Œé¡µé¢ (/auth/signup)
    â†“
ç”¨æˆ·è¾“å…¥: Email + Username + Password
    â†“
ç‚¹å‡» "Create Account" æŒ‰é’®
    â†“
è°ƒç”¨ POST /api/auth/signup
    â†“
æˆåŠŸ: ä¿å­˜tokenå’Œç”¨æˆ·ä¿¡æ¯ â†’ é‡å®šå‘åˆ° /home
å¤±è´¥: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
```

**æ³¨å†Œé¡µé¢åŠŸèƒ½**:
- è¾“å…¥æ¡†ï¼š
  - Emailï¼ˆå¿…å¡«ï¼Œtype=emailï¼‰
  - Usernameï¼ˆå¿…å¡«ï¼Œtype=textï¼‰
  - Passwordï¼ˆå¿…å¡«ï¼Œtype=passwordï¼‰
- æŒ‰é’®ï¼š
  - "Create Account"ï¼šæäº¤æ³¨å†Œè¡¨å•
    - åŠ è½½ä¸­æ˜¾ç¤º "Creating..."
    - ç¦ç”¨çŠ¶æ€ï¼šloading=trueæ—¶
- é“¾æ¥ï¼š
  - "Sign in"ï¼šè·³è½¬åˆ° `/auth/login`
- é”™è¯¯æ˜¾ç¤ºï¼šæ³¨å†Œå¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

---

## å…¨å±€ç»„ä»¶

### Header é¡¶éƒ¨å¯¼èˆªæ 

**ä½ç½®**: æ‰€æœ‰é¡µé¢é¡¶éƒ¨ï¼Œstickyå®šä½ï¼Œå§‹ç»ˆå¯è§

**å“ç‰ŒåŒºåŸŸ**:
- "AfterWord / Iteration Lab" logo
- ç‚¹å‡»åè·³è½¬åˆ° `/home`ï¼ˆéœ€ç™»å½•ï¼‰

**å¯¼èˆªé“¾æ¥** (æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹):

**æœªç™»å½•çŠ¶æ€**:
- Whyï¼šè·³è½¬åˆ° `/why`
- Aboutï¼šè·³è½¬åˆ° `/about`
- Sign In æŒ‰é’®ï¼šè·³è½¬åˆ° `/auth/login`

**å·²ç™»å½•çŠ¶æ€**:
- Worksï¼šè·³è½¬åˆ° `/works`
- Whyï¼šè·³è½¬åˆ° `/why`
- Aboutï¼šè·³è½¬åˆ° `/about`
- ç”¨æˆ·ä¿¡æ¯ï¼šæ˜¾ç¤ºç”¨æˆ·åæˆ–é‚®ç®±
- Sign Out æŒ‰é’®ï¼šç™»å‡ºå¹¶é‡å®šå‘åˆ° `/auth/login`

**è®¾è®¡ç‰¹æ€§**:
- åŠé€æ˜èƒŒæ™¯ + èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ (backdrop-filter)
- Coldä¸»é¢˜æ¸å˜æŒ‰é’®
- å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯è‡ªåŠ¨éšè—éƒ¨åˆ†å…ƒç´ 

---

### 4. é¦–é¡µæµç¨‹

```
ç™»å½•æˆåŠŸ â†’ /home
    â†“
æ˜¾ç¤ºé¦–é¡µ
```

**HomePageåŠŸèƒ½** (`/home`):

**HeroåŒºåŸŸ**:
- æ ‡é¢˜ï¼šWelcome to AfterWord
- å‰¯æ ‡é¢˜ï¼šAI-Assisted Writing Platform è¯´æ˜
- è¡ŒåŠ¨æŒ‰é’®ï¼š
  - "Go to Works"ï¼šè·³è½¬åˆ° `/works` æŸ¥çœ‹ä½œå“åˆ—è¡¨
  - "Learn More"ï¼šè·³è½¬åˆ° `/why` äº†è§£äº§å“

**åŠŸèƒ½ç‰¹æ€§ç½‘æ ¼** (4ä¸ªå¡ç‰‡):
1. **Iterative Writing** (ğŸ“)
   - è¯´æ˜ï¼šè¿­ä»£å†™ä½œå’ŒAIæŒ‡å¯¼
2. **AI Analysis** (ğŸ¤–)
   - è¯´æ˜ï¼šAIåé¦ˆåˆ†æ
3. **Version Control** (ğŸ“Š)
   - è¯´æ˜ï¼šç‰ˆæœ¬æ§åˆ¶å’Œå†å²è®°å½•
4. **Focused Feedback** (ğŸ¯)
   - è¯´æ˜ï¼šå¥çº§è¯„è®ºå’Œåé¦ˆå¤„ç†

**CTAåŒºåŸŸ**:
- æ ‡é¢˜ï¼šReady to start writing?
- æŒ‰é’®ï¼š"Create Your First Work" â†’ è·³è½¬åˆ° `/works`

### 5. ä½œå“åˆ—è¡¨é¡µé¢æµç¨‹

```
ç‚¹å‡»"Go to Works" â†’ /works
    â†“
è‡ªåŠ¨åŠ è½½ä½œå“åˆ—è¡¨ (GET /api/work/list)
    â†“
æ˜¾ç¤ºç”¨æˆ·çš„æ‰€æœ‰ä½œå“
```

**Worksé¡µé¢åŠŸèƒ½** (`/works`):

**é¡µé¢å¤´éƒ¨**:
- æ ‡é¢˜ï¼šWorks
- è¯´æ˜ï¼šManage your works and open one to continue editing.
- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºï¼šSigned in as **[username/email]**
- æŒ‰é’®ï¼š
  - "Sign Out"ï¼šç™»å‡º
    - ç‚¹å‡»åæ¸…é™¤ä¼šè¯ï¼Œé‡å®šå‘åˆ° `/auth/login`

**ä½œå“åˆ—è¡¨é¢æ¿**:
- æ ‡é¢˜ï¼šYour Works
- æŒ‰é’®ï¼š
  - "New Work"ï¼šåˆ›å»ºæ–°ä½œå“
    - è°ƒç”¨ POST /api/work/create
    - æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°æ–°ä½œå“è¯¦æƒ…é¡µ `/works/[æ–°workId]`
- ä½œå“åˆ—è¡¨ï¼š
  - æ¯ä¸ªä½œå“æ˜¾ç¤ºï¼š
    - æ ‡é¢˜ï¼šUntitled Workï¼ˆé“¾æ¥ï¼Œç‚¹å‡»è·³è½¬åˆ° `/works/[workId]`ï¼‰
    - æ›´æ–°æ—¶é—´ï¼šæ ¼å¼åŒ–çš„æ—¥æœŸæ—¶é—´
    - æŒ‰é’®ï¼š
      - "Delete"ï¼šåˆ é™¤è¯¥ä½œå“
        - è°ƒç”¨ DELETE /api/work/[workId]
        - æˆåŠŸåè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
- çŠ¶æ€æ˜¾ç¤ºï¼š
  - Loading: "Loading works..."
  - Empty: "No works yet."
  - Error: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

**å¯¼èˆªç»„ä»¶** (TestRouteSwitches):
- "Works" æŒ‰é’®ï¼šè·³è½¬åˆ° `/works`
- "Why" æŒ‰é’®ï¼šè·³è½¬åˆ° `/why`
- "About" æŒ‰é’®ï¼šè·³è½¬åˆ° `/about`

### 6. ä½œå“è¯¦æƒ…é¡µé¢æµç¨‹

```
ç‚¹å‡»ä½œå“ â†’ /works/:workId
    â†“
å¹¶å‘åŠ è½½ä¸‰ä¸ªæ•°æ®ï¼š
1. ä½œå“è¯¦æƒ… (GET /api/work/:workId)
2. æ‰€æœ‰ç‰ˆæœ¬åˆ—è¡¨ (GET /api/work/:workId/versions?type=all)
3. å·²æäº¤ç‰ˆæœ¬åˆ—è¡¨ (GET /api/work/:workId/versions?type=submitted)
    â†“
æ˜¾ç¤ºç¼–è¾‘å™¨å’Œç‰ˆæœ¬å†å²
```

**Work Detailé¡µé¢åŠŸèƒ½** (`/works/:workId`):

#### é¡µé¢å¤´éƒ¨
- æ ‡é¢˜ï¼šWork Detail
- è¯´æ˜ï¼šRead, save, submit, inspect versions, and revert.
- å½“å‰Work IDæ˜¾ç¤º

#### ç¼–è¾‘å™¨åŒºåŸŸ

**å†…å®¹ç¼–è¾‘å™¨**:
- Label: "Content"
- å¤§æ–‡æœ¬æ¡†ï¼ˆtextareaï¼Œ10è¡Œï¼‰
- åŠŸèƒ½ï¼š
  - å®æ—¶ç¼–è¾‘ä½œå“å†…å®¹
  - è‡ªåŠ¨ä¿å­˜ï¼ˆ3ç§’å»¶è¿Ÿï¼‰
  - æœ¬åœ°è‰ç¨¿ç¼“å­˜ï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰
- åªè¯»æ¨¡å¼ï¼šå½“ä½œå“è¢«å…¶ä»–è®¾å¤‡é”å®šæ—¶

**ä¿å­˜æŒ‰é’®**:
1. "Auto Save"ï¼šæ‰‹åŠ¨è§¦å‘è‡ªåŠ¨ä¿å­˜
   - è°ƒç”¨ POST /api/work/:workId/update (auto_save=true)
   - ä¸åˆ›å»ºæ–°ç‰ˆæœ¬
   - ç¦ç”¨æ¡ä»¶ï¼šæ— workIdã€æ­£åœ¨ä¿å­˜ã€é”å®šçŠ¶æ€

2. "Save Draft Version"ï¼šä¿å­˜è‰ç¨¿ç‰ˆæœ¬
   - è°ƒç”¨ POST /api/work/:workId/update (auto_save=false)
   - åˆ›å»ºæ–°çš„draftç‰ˆæœ¬
   - ç¦ç”¨æ¡ä»¶ï¼šæ— workIdã€æ­£åœ¨ä¿å­˜ã€é”å®šçŠ¶æ€
   - æˆåŠŸåæ˜¾ç¤ºæ–°ç‰ˆæœ¬å·

#### å½“å‰æäº¤å®¡é˜…é˜Ÿåˆ—

æ˜¾ç¤ºæœ€æ–°å·²æäº¤ç‰ˆæœ¬çš„AIåˆ†æç»“æœï¼š

**é¦–æ¬¡æäº¤å‰**:
- æ˜¾ç¤ºï¼š"No prior submitted analysis. First submit can proceed directly."

**æœ‰åˆ†æç»“æœå**:
- æ˜¾ç¤ºæœªå¤„ç†çš„è¯„è®ºæ•°é‡
- å¥å­è¯„è®ºåˆ—è¡¨ï¼ˆSentence Commentsï¼‰ï¼š
  - æ¯æ¡è¯„è®ºæ˜¾ç¤ºï¼š
    - æ ‡é¢˜ï¼ˆtitleï¼‰
    - æè¿°ï¼ˆdescriptionï¼‰
    - å»ºè®®ï¼ˆsuggestionï¼‰
  - æ“ä½œæŒ‰é’®ï¼š
    - "Mark Resolved" / "Resolved âœ“"ï¼šæ ‡è®°ä¸ºå·²è§£å†³
      - ç‚¹å‡»åæ ‡è®°çŠ¶æ€åˆ‡æ¢
      - å·²æ ‡è®°æ—¶æ˜¾ç¤ºå‹¾å·
    - "Reject" / "Rejected âœ“"ï¼šæ‹’ç»å»ºè®®
      - ç‚¹å‡»åæ ‡è®°çŠ¶æ€åˆ‡æ¢
      - å·²æ ‡è®°æ—¶æ˜¾ç¤ºå‹¾å·
  - ç”¨æˆ·å¤‡æ³¨è¾“å…¥æ¡†ï¼š
    - ä»…åœ¨æ ‡è®°ä¸º"resolved"æ—¶å¯ç”¨
    - å ä½ç¬¦ï¼š"Optional note when resolved"
    - å¯è¾“å…¥å¤„ç†è¯¥å»ºè®®çš„è¯´æ˜

#### æäº¤åŒºåŸŸ

**è¡¨å•å­—æ®µ**:
- Label: "FAO Reflection"
- æ–‡æœ¬æ¡†ï¼ˆtextareaï¼Œ3è¡Œï¼‰
- å ä½ç¬¦ï¼š"optional reflection"
- ç”¨äºè¾“å…¥å¯¹æœ¬æ¬¡æäº¤çš„åæ€

**æäº¤æŒ‰é’®**:
- "Submit + Fetch Analysis"ï¼šæäº¤å¹¶è·å–AIåˆ†æ
- åŠŸèƒ½ï¼š
  - å…ˆæ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¥å­è¯„è®ºéƒ½å·²å¤„ç†ï¼ˆæ ‡è®°ä¸ºresolvedæˆ–rejectedï¼‰
  - å¦‚æœæœ‰æœªå¤„ç†çš„è¯„è®ºï¼Œé˜»æ­¢æäº¤å¹¶æ˜¾ç¤ºé”™è¯¯
  - è°ƒç”¨ POST /api/work/:workId/submit
  - æäº¤å†…å®¹ï¼šå½“å‰content + fao_reflection + suggestion_actions
  - è‡ªåŠ¨è·å–æ–°ç‰ˆæœ¬çš„AIåˆ†æ
  - æˆåŠŸåï¼š
    - æ¸…ç©ºsuggestionMarkings
    - æ¸…ç©ºfaoReflectionDraft
    - æ˜¾ç¤ºæ–°åˆ†æç»“æœ
- ç¦ç”¨æ¡ä»¶ï¼šæ— workIdã€æ­£åœ¨æäº¤ã€é”å®šçŠ¶æ€

#### ç‰ˆæœ¬å†å²åŒºåŸŸ

**ç‰ˆæœ¬åˆ—è¡¨æ˜¾ç¤º**:
- æ ‡é¢˜ï¼šVersions
- é»˜è®¤æ˜¾ç¤ºæœ€æ–°50ä¸ªç‰ˆæœ¬
- å¦‚æœæœ‰æ›´å¤šç‰ˆæœ¬ï¼š
  - æ˜¾ç¤ºæç¤ºï¼š`Showing latest X versions. Y older versions hidden.`
  - æŒ‰é’®ï¼š"Load Older Versions"
    - ç‚¹å‡»åŠ è½½æ›´å¤š50ä¸ªç‰ˆæœ¬
- æ¯ä¸ªç‰ˆæœ¬æ˜¾ç¤ºï¼š
  - ç‰ˆæœ¬å·ï¼šv{number}
  - å˜æ›´ç±»å‹ï¼šdraft / submitted
  - æ“ä½œæŒ‰é’®ï¼š
    - "Open"ï¼šæŸ¥çœ‹ç‰ˆæœ¬è¯¦æƒ…
      - è°ƒç”¨ GET /api/work/:workId/versions/{versionNumber}
      - åœ¨é¡µé¢ä¸‹æ–¹æ˜¾ç¤ºç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯
    - "Revert"ï¼šæ¢å¤åˆ°è¯¥ç‰ˆæœ¬
      - ç‚¹å‡»åå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
      - ç¦ç”¨æ¡ä»¶ï¼šæ­£åœ¨æ¢å¤ã€é”å®šçŠ¶æ€

**ç‰ˆæœ¬è¯¦æƒ…æ˜¾ç¤º**ï¼ˆé€‰ä¸­ç‰ˆæœ¬åï¼‰:
- ç‰ˆæœ¬å·ï¼šv{number}
- å˜æ›´ç±»å‹
- å†…å®¹é¢„è§ˆï¼ˆå‰300å­—ç¬¦ï¼‰
- AIåˆ†æï¼ˆå¦‚æœæœ‰ï¼‰ï¼š
  - FAO Comment
  - Reflection Commentï¼ˆå¦‚æœæœ‰ï¼‰
  - å¥å­è¯„è®ºåˆ—è¡¨ï¼ˆæ˜¾ç¤ºæ•°é‡ï¼‰
    - æ¯æ¡è¯„è®ºï¼šæ ‡é¢˜ã€æè¿°ã€å»ºè®®ã€æ”¹è¿›åé¦ˆï¼ˆå¦‚æœæœ‰ï¼‰

**æ¢å¤ç¡®è®¤å¯¹è¯æ¡†**:
è§¦å‘æ¡ä»¶ï¼šç‚¹å‡»æŸä¸ªç‰ˆæœ¬çš„"Revert"æŒ‰é’®

æ˜¾ç¤ºå†…å®¹ï¼š
- æ ‡é¢˜ï¼šRevert to Version {number}?
- è¯´æ˜ï¼š
  - "This will create a new draft using content from version {number}."
  - "Your current unsaved changes may be lost."
  - "You can undo this by reverting back to version {current}."
- æ“ä½œæŒ‰é’®ï¼š
  1. "Cancel"ï¼šå–æ¶ˆæ¢å¤
  2. "Save Current First"ï¼šå…ˆä¿å­˜å½“å‰å†…å®¹ï¼Œå†æ¢å¤
     - å…ˆè°ƒç”¨ä¿å­˜è‰ç¨¿
     - å†è°ƒç”¨ POST /api/work/:workId/revert
  3. "Revert Anyway"ï¼šç›´æ¥æ¢å¤ï¼ˆä¸ä¿å­˜å½“å‰å†…å®¹ï¼‰
     - è°ƒç”¨ POST /api/work/:workId/revert
     - åˆ›å»ºæ–°çš„draftç‰ˆæœ¬ï¼Œå†…å®¹ä¸ºæŒ‡å®šç‰ˆæœ¬çš„å†…å®¹

#### çŠ¶æ€æ˜¾ç¤º

**åŠ è½½çŠ¶æ€**:
- "Loading work detail..."

**é”å®šçŠ¶æ€æ¨ªå¹…**:
- "Locked by another device. Read-only mode active. Retrying refresh in {N}s."
- æ¯ç§’å€’è®¡æ—¶
- 5ç§’åè‡ªåŠ¨å°è¯•é‡æ–°åŠ è½½

**é”™è¯¯æç¤º**:
- æ˜¾ç¤ºAPIé”™è¯¯ä¿¡æ¯
- é¢œè‰²ï¼šçº¢è‰²

**ä¿¡æ¯æç¤º**:
- æ˜¾ç¤ºæ“ä½œæˆåŠŸä¿¡æ¯
- ä¾‹å¦‚ï¼š
  - "Auto-saved successfully"
  - "Saved with new version {N}"
  - "Submitted version {N} and loaded analysis"
  - "Loaded version {N}"
  - "Reverted successfully. New draft version {N}"
  - "Recovered an unsynced local draft."
  - "Server state refreshed, local unsaved text preserved."

**å¯¼èˆªç»„ä»¶**:
- åŒä½œå“åˆ—è¡¨é¡µçš„TestRouteSwitches

---

## åŠŸèƒ½è¯¦è§£

### è®¤è¯ç³»ç»Ÿ

#### AuthSessionContextï¼ˆè®¤è¯ä¼šè¯ä¸Šä¸‹æ–‡ï¼‰

**æä¾›çš„çŠ¶æ€å’Œæ–¹æ³•**:
```typescript
{
  user: AuthUser | null;              // å½“å‰ç”¨æˆ·ä¿¡æ¯
  token: string | null;               // è®¤è¯token
  isAuthenticated: boolean;           // æ˜¯å¦å·²è®¤è¯
  login: (emailOrUsername, password) => Promise<void>;
  signup: (email, username, password) => Promise<void>;
  logout: () => void;
}
```

**å­˜å‚¨æœºåˆ¶**:
- ä½¿ç”¨localStorageå­˜å‚¨tokenå’Œuserä¿¡æ¯
- Key: `afterword_auth_token`, `afterword_auth_user`
- è‡ªåŠ¨ç›‘å¬ä¼šè¯è¿‡æœŸäº‹ä»¶ï¼ˆAUTH_SESSION_EXPIRED_EVENTï¼‰

#### è®¤è¯API

**ç™»å½•**: `POST /api/auth/login`
- è¯·æ±‚ä½“ï¼š`{ email_or_username, password }`
- å“åº”ï¼š`{ token, user }`

**æ³¨å†Œ**: `POST /api/auth/signup`
- è¯·æ±‚ä½“ï¼š`{ email, username, password }`
- å“åº”ï¼š`{ token, user }`

### ä½œå“ç®¡ç†ç³»ç»Ÿ

#### useWorksList Hook

**çŠ¶æ€**:
```typescript
{
  items: WorkSummary[];    // ä½œå“åˆ—è¡¨
  loading: boolean;         // æ˜¯å¦åŠ è½½ä¸­
  error: string | null;     // é”™è¯¯ä¿¡æ¯
}
```

**æ–¹æ³•**:
- `reload()`: é‡æ–°åŠ è½½ä½œå“åˆ—è¡¨
- `runCreate()`: åˆ›å»ºæ–°ä½œå“ï¼Œè¿”å›workId
- `runDelete(workId)`: åˆ é™¤æŒ‡å®šä½œå“

#### useWorkDetail Hook

**æ ¸å¿ƒçŠ¶æ€**:
```typescript
{
  work: WorkDetail | null;                  // ä½œå“è¯¦æƒ…
  content: string;                          // å½“å‰ç¼–è¾‘å†…å®¹
  faoReflectionDraft: string;              // æäº¤åæ€è‰ç¨¿
  allVersions: WorkVersionSummary[];       // æ‰€æœ‰ç‰ˆæœ¬
  versions: WorkVersionSummary[];          // æ˜¾ç¤ºçš„ç‰ˆæœ¬ï¼ˆåˆ†é¡µï¼‰
  hiddenVersionCount: number;              // éšè—çš„ç‰ˆæœ¬æ•°
  selectedVersion: WorkVersionDetail | null;  // é€‰ä¸­çš„ç‰ˆæœ¬è¯¦æƒ…
  baselineSubmittedVersion: WorkVersionDetail | null; // æœ€æ–°æäº¤ç‰ˆæœ¬
  suggestionMarkings: Record<string, {     // å»ºè®®æ ‡è®°çŠ¶æ€
    action: 'resolved' | 'rejected';
    userNote?: string;
  }>;
  loading: boolean;
  saving: boolean;
  submitting: boolean;
  reverting: boolean;
  locked: boolean;                         // æ˜¯å¦è¢«å…¶ä»–è®¾å¤‡é”å®š
  lockRetryInSec: number;                 // é”å®šé‡è¯•å€’è®¡æ—¶
  error: string | null;
  info: string | null;
}
```

**æ ¸å¿ƒåŠŸèƒ½**:

1. **è‡ªåŠ¨ä¿å­˜æœºåˆ¶**:
   - ç›‘å¬contentå˜åŒ–
   - 3ç§’å»¶è¿Ÿåè‡ªåŠ¨è§¦å‘ä¿å­˜
   - ä½¿ç”¨é˜²æŠ–å¤„ç†è¿ç»­ç¼–è¾‘
   - ä¿å­˜æ—¶ä¸åˆ›å»ºæ–°ç‰ˆæœ¬

2. **æœ¬åœ°è‰ç¨¿ç¼“å­˜**:
   - ä½¿ç”¨localStorageç¼“å­˜æœªä¿å­˜çš„å†…å®¹
   - Key: `afterword_draft_{workId}`
   - åœ¨æœåŠ¡å™¨çŠ¶æ€åˆ·æ–°æ—¶ä¿ç•™æœ¬åœ°æœªä¿å­˜å†…å®¹
   - ä¿å­˜æˆåŠŸåæ¸…é™¤ç¼“å­˜

3. **è®¾å¤‡é”æœºåˆ¶**:
   - åŒä¸€ä½œå“åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªè®¾å¤‡ç¼–è¾‘
   - è¢«é”å®šæ—¶è¿›å…¥åªè¯»æ¨¡å¼
   - æ¯5ç§’è‡ªåŠ¨å°è¯•é‡æ–°è·å–é”

4. **ç‰ˆæœ¬ç®¡ç†**:
   - æ”¯æŒåˆ†é¡µåŠ è½½ï¼ˆæ¯é¡µ50ä¸ªï¼‰
   - å¯æŸ¥çœ‹ä»»æ„ç‰ˆæœ¬çš„è¯¦æƒ…å’Œåˆ†æ
   - å¯æ¢å¤åˆ°ä»»æ„å†å²ç‰ˆæœ¬

5. **å»ºè®®å¤„ç†æµç¨‹**:
   - æŸ¥çœ‹æœ€æ–°æäº¤ç‰ˆæœ¬çš„sentence comments
   - é€æ¡æ ‡è®°ä¸ºresolvedæˆ–rejected
   - å¯ä¸ºresolvedçš„å»ºè®®æ·»åŠ ç”¨æˆ·å¤‡æ³¨
   - ä¸‹æ¬¡æäº¤æ—¶å¿…é¡»å¤„ç†æ‰€æœ‰æœªå¤„ç†çš„å»ºè®®

**æ–¹æ³•**:
- `setContent(value)`: æ›´æ–°ç¼–è¾‘å†…å®¹
- `setFaoReflectionDraft(value)`: æ›´æ–°åæ€è‰ç¨¿
- `save(autoSave)`: ä¿å­˜ä½œå“
  - `autoSave=true`: ä¸åˆ›å»ºæ–°ç‰ˆæœ¬
  - `autoSave=false`: åˆ›å»ºæ–°draftç‰ˆæœ¬
- `submit()`: æäº¤å¹¶è·å–AIåˆ†æ
- `openVersion(versionNumber)`: æŸ¥çœ‹ç‰ˆæœ¬è¯¦æƒ…
- `revert(versionNumber)`: æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬
- `loadMoreVersions()`: åŠ è½½æ›´å¤šå†å²ç‰ˆæœ¬
- `markSuggestionAction(commentId, action)`: æ ‡è®°å»ºè®®å¤„ç†çŠ¶æ€
- `setSuggestionNote(commentId, note)`: è®¾ç½®å»ºè®®å¤„ç†å¤‡æ³¨

#### ä½œå“API

**æ ¸å¿ƒæ¥å£**:
- `POST /api/work/create`: åˆ›å»ºä½œå“
- `GET /api/work/list`: è·å–ä½œå“åˆ—è¡¨
- `GET /api/work/:workId`: è·å–ä½œå“è¯¦æƒ…
- `POST /api/work/:workId/update`: æ›´æ–°ä½œå“å†…å®¹
- `POST /api/work/:workId/submit`: æäº¤å¹¶è·å–åˆ†æ
- `DELETE /api/work/:workId`: åˆ é™¤ä½œå“
- `GET /api/work/:workId/versions`: è·å–ç‰ˆæœ¬åˆ—è¡¨
  - æŸ¥è¯¢å‚æ•°ï¼š`type=all|submitted|draft`, `parent={number}`
- `GET /api/work/:workId/versions/:versionNumber`: è·å–ç‰ˆæœ¬è¯¦æƒ…
- `POST /api/work/:workId/revert`: æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬

**è¯·æ±‚å¤´**:
- `Authorization: Bearer {token}`: æ‰€æœ‰å—ä¿æŠ¤æ¥å£éœ€è¦
- `Content-Type: application/json`
- `If-None-Match: {etag}`: GETè¯·æ±‚æ”¯æŒETagç¼“å­˜

**é”™è¯¯å¤„ç†**:
- 401: ä¼šè¯è¿‡æœŸï¼Œè§¦å‘é‡æ–°ç™»å½•
- 404: ä½œå“ä¸å­˜åœ¨
- 423: ä½œå“è¢«é”å®š
- 429: è¯·æ±‚é¢‘ç‡è¿‡é«˜
- validation_failed: éªŒè¯å¤±è´¥
- suggestions_not_processed: æœ‰æœªå¤„ç†çš„å»ºè®®
- llm_failed: AIåˆ†æå¤±è´¥

---

## çŠ¶æ€ç®¡ç†

### å…¨å±€çŠ¶æ€

**AuthSessionContextï¼ˆè®¤è¯çŠ¶æ€ï¼‰**:
- ä½œç”¨åŸŸï¼šæ•´ä¸ªåº”ç”¨
- æä¾›ï¼šç”¨æˆ·ä¿¡æ¯ã€tokenã€è®¤è¯æ–¹æ³•
- æŒä¹…åŒ–ï¼šlocalStorage

### é¡µé¢çº§çŠ¶æ€

**WorksPageï¼ˆä½œå“åˆ—è¡¨çŠ¶æ€ï¼‰**:
- useWorksList hookç®¡ç†
- è‡ªåŠ¨åŠ è½½å’Œåˆ·æ–°

**WorkDetailPageï¼ˆä½œå“è¯¦æƒ…çŠ¶æ€ï¼‰**:
- useWorkDetail hookç®¡ç†
- å¤æ‚çš„å¤šçŠ¶æ€åè°ƒï¼š
  - ç¼–è¾‘çŠ¶æ€
  - ä¿å­˜çŠ¶æ€
  - æäº¤çŠ¶æ€
  - ç‰ˆæœ¬ç®¡ç†çŠ¶æ€
  - é”å®šçŠ¶æ€
  - å»ºè®®å¤„ç†çŠ¶æ€

### æœ¬åœ°ç¼“å­˜

**è®¤è¯ä¿¡æ¯**:
- `afterword_auth_token`: JWT token
- `afterword_auth_user`: ç”¨æˆ·ä¿¡æ¯JSON

**è‰ç¨¿ç¼“å­˜**:
- `afterword_draft_{workId}`: æœªä¿å­˜çš„å†…å®¹
- æ ¼å¼ï¼š`{ content: string, timestamp: number }`

**APIç¼“å­˜**:
- ä½¿ç”¨Mapåœ¨å†…å­˜ä¸­ç¼“å­˜GETè¯·æ±‚
- æ”¯æŒETagéªŒè¯
- å†™æ“ä½œåè‡ªåŠ¨invalidateç›¸å…³ç¼“å­˜

---

## ç”¨æˆ·äº¤äº’æµç¨‹æ€»ç»“

### å…¸å‹å·¥ä½œæµç¨‹

1. **å¼€å§‹ä½¿ç”¨**:
   ```
   è®¿é—®ç½‘ç«™ â†’ æ³¨å†Œè´¦å· â†’ è‡ªåŠ¨ç™»å½• â†’ è¿›å…¥ä½œå“åˆ—è¡¨
   ```

2. **åˆ›å»ºå’Œç¼–è¾‘ä½œå“**:
   ```
   ç‚¹å‡»"New Work" â†’ è·³è½¬åˆ°è¯¦æƒ…é¡µ â†’ ç¼–è¾‘å†…å®¹ â†’ è‡ªåŠ¨ä¿å­˜
   ```

3. **ä¿å­˜è‰ç¨¿ç‰ˆæœ¬**:
   ```
   ç¼–è¾‘å†…å®¹ â†’ ç‚¹å‡»"Save Draft Version" â†’ åˆ›å»ºæ–°ç‰ˆæœ¬ â†’ ç»§ç»­ç¼–è¾‘
   ```

4. **é¦–æ¬¡æäº¤**:
   ```
   ç¼–è¾‘å®Œæˆ â†’ (å¯é€‰)å¡«å†™FAO Reflection â†’ ç‚¹å‡»"Submit + Fetch Analysis"
   â†’ ç­‰å¾…åˆ†æ â†’ æŸ¥çœ‹AIåé¦ˆ
   ```

5. **å¤„ç†åé¦ˆå¹¶å†æ¬¡æäº¤**:
   ```
   æŸ¥çœ‹sentence comments â†’ é€æ¡æ ‡è®°resolved/rejected â†’ æ·»åŠ å¤‡æ³¨
   â†’ ä¿®æ”¹å†…å®¹ â†’ å¡«å†™reflection â†’ æäº¤ â†’ è·å–æ–°åˆ†æ
   ```

6. **ç‰ˆæœ¬ç®¡ç†**:
   ```
   ç‚¹å‡»"Open"æŸ¥çœ‹å†å²ç‰ˆæœ¬ â†’ æŸ¥çœ‹è¯¥ç‰ˆæœ¬çš„åˆ†æ
   â†’ (å¦‚éœ€è¦)ç‚¹å‡»"Revert"æ¢å¤åˆ°è¯¥ç‰ˆæœ¬
   ```

7. **å¤šè®¾å¤‡åä½œ**:
   ```
   è®¾å¤‡Aç¼–è¾‘ â†’ è®¾å¤‡Bå°è¯•ç¼–è¾‘ â†’ è¢«é”å®šæç¤º
   â†’ è¿›å…¥åªè¯»æ¨¡å¼ â†’ ç­‰å¾…æˆ–åœ¨è®¾å¤‡Aå®Œæˆ
   ```

### æŒ‰é’®å¿«é€Ÿå‚è€ƒ

| æŒ‰é’®/é“¾æ¥ | ä½ç½® | åŠŸèƒ½ | è·³è½¬/ç»“æœ |
|-----------|------|------|-----------|
| Sign In | ç™»å½•é¡µ | æäº¤ç™»å½• | æˆåŠŸâ†’/works |
| Create account | ç™»å½•é¡µ | é“¾æ¥ | è·³è½¬â†’/auth/signup |
| Create Account | æ³¨å†Œé¡µ | æäº¤æ³¨å†Œ | æˆåŠŸâ†’/works |
| Sign in | æ³¨å†Œé¡µ | é“¾æ¥ | è·³è½¬â†’/auth/login |
| Sign Out | Worksé¡µ | ç™»å‡º | è·³è½¬â†’/auth/login |
| New Work | Worksé¡µ | åˆ›å»ºä½œå“ | è·³è½¬â†’/works/[newId] |
| Delete | Worksé¡µåˆ—è¡¨é¡¹ | åˆ é™¤ä½œå“ | åˆ·æ–°åˆ—è¡¨ |
| Untitled Work | Worksé¡µåˆ—è¡¨é¡¹ | é“¾æ¥ | è·³è½¬â†’/works/[workId] |
| Auto Save | è¯¦æƒ…é¡µ | æ‰‹åŠ¨è‡ªåŠ¨ä¿å­˜ | ä¿å­˜å½“å‰å†…å®¹ |
| Save Draft Version | è¯¦æƒ…é¡µ | ä¿å­˜è‰ç¨¿ç‰ˆæœ¬ | åˆ›å»ºæ–°ç‰ˆæœ¬ |
| Mark Resolved | è¯¦æƒ…é¡µè¯„è®º | æ ‡è®°å·²è§£å†³ | çŠ¶æ€åˆ‡æ¢ |
| Reject | è¯¦æƒ…é¡µè¯„è®º | æ‹’ç»å»ºè®® | çŠ¶æ€åˆ‡æ¢ |
| Submit + Fetch Analysis | è¯¦æƒ…é¡µ | æäº¤è·å–åˆ†æ | åˆ›å»ºæäº¤ç‰ˆæœ¬+è·å–AIåˆ†æ |
| Open | ç‰ˆæœ¬åˆ—è¡¨é¡¹ | æŸ¥çœ‹ç‰ˆæœ¬ | æ˜¾ç¤ºç‰ˆæœ¬è¯¦æƒ… |
| Revert | ç‰ˆæœ¬åˆ—è¡¨é¡¹ | æ¢å¤ç‰ˆæœ¬ | å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡† |
| Load Older Versions | ç‰ˆæœ¬å†å² | åŠ è½½æ›´å¤š | æ˜¾ç¤ºæ›´å¤šç‰ˆæœ¬ |
| Cancel | æ¢å¤ç¡®è®¤ | å–æ¶ˆæ¢å¤ | å…³é—­å¯¹è¯æ¡† |
| Save Current First | æ¢å¤ç¡®è®¤ | å…ˆä¿å­˜å†æ¢å¤ | ä¿å­˜â†’æ¢å¤â†’æ–°ç‰ˆæœ¬ |
| Revert Anyway | æ¢å¤ç¡®è®¤ | ç›´æ¥æ¢å¤ | æ¢å¤â†’æ–°ç‰ˆæœ¬ |
| Works | å¯¼èˆª | é“¾æ¥ | è·³è½¬â†’/works |
| Why | å¯¼èˆª | é“¾æ¥ | è·³è½¬â†’/why |
| About | å¯¼èˆª | é“¾æ¥ | è·³è½¬â†’/about |

---

## ç‰¹æ®Šåœºæ™¯å¤„ç†

### ä¼šè¯è¿‡æœŸ
- è§¦å‘ï¼šAPIè¿”å›401
- å¤„ç†ï¼š
  1. æ¸…é™¤æœ¬åœ°è®¤è¯ä¿¡æ¯
  2. è§¦å‘AUTH_SESSION_EXPIRED_EVENT
  3. AuthSessionContextæ›´æ–°çŠ¶æ€
  4. è·¯ç”±å®ˆå«è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ

### è®¾å¤‡é”å®šå†²çª
- è§¦å‘ï¼šAPIè¿”å›423ï¼ˆlockedï¼‰
- å¤„ç†ï¼š
  1. è¿›å…¥åªè¯»æ¨¡å¼
  2. æ˜¾ç¤ºé”å®šæ¨ªå¹…
  3. æ¯5ç§’è‡ªåŠ¨å°è¯•é‡æ–°è·å–
  4. è·å–æˆåŠŸåè‡ªåŠ¨è§£é™¤é”å®š

### æœ¬åœ°è‰ç¨¿æ¢å¤
- åœºæ™¯ï¼šé¡µé¢åˆ·æ–°æˆ–å¼‚å¸¸å…³é—­
- å¤„ç†ï¼š
  1. æ£€æŸ¥localStorageä¸­çš„è‰ç¨¿ç¼“å­˜
  2. å¦‚æœæœ‰ä¸”ä¸æœåŠ¡å™¨å†…å®¹ä¸åŒ
  3. è‡ªåŠ¨æ¢å¤æœ¬åœ°å†…å®¹
  4. æ˜¾ç¤ºæç¤ºï¼š"Recovered an unsynced local draft."

### æœªå¤„ç†å»ºè®®é˜»æ­¢æäº¤
- åœºæ™¯ï¼šæœ‰æœªå¤„ç†çš„sentence commentsæ—¶æäº¤
- å¤„ç†ï¼š
  1. å‰ç«¯å…ˆæ£€æŸ¥æ‰€æœ‰commentæ˜¯å¦å·²æ ‡è®°
  2. å¦‚æœæœ‰æœªæ ‡è®°çš„ï¼Œæ˜¾ç¤ºé”™è¯¯
  3. ä¸å‘é€æäº¤è¯·æ±‚
  4. åç«¯ä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„æ£€æŸ¥ï¼ˆåŒé‡ä¿éšœï¼‰

---

## æŠ€æœ¯ç‰¹æ€§

### æ€§èƒ½ä¼˜åŒ–

1. **APIç¼“å­˜**:
   - GETè¯·æ±‚ä½¿ç”¨å†…å­˜ç¼“å­˜
   - æ”¯æŒETagæ¡ä»¶è¯·æ±‚
   - å†™æ“ä½œåæ™ºèƒ½invalidate

2. **è‡ªåŠ¨ä¿å­˜é˜²æŠ–**:
   - 3ç§’å»¶è¿Ÿ
   - é¿å…é¢‘ç¹APIè°ƒç”¨
   - é˜Ÿåˆ—å¤„ç†è¿ç»­å˜æ›´

3. **ç‰ˆæœ¬åˆ†é¡µåŠ è½½**:
   - é»˜è®¤50æ¡
   - æŒ‰éœ€åŠ è½½æ›´å¤š
   - å‡å°‘åˆå§‹åŠ è½½æ—¶é—´

### ç”¨æˆ·ä½“éªŒ

1. **åŠ è½½çŠ¶æ€åé¦ˆ**:
   - æ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½æœ‰loadingçŠ¶æ€
   - æŒ‰é’®æ˜¾ç¤ºåŠ è½½æ–‡æœ¬
   - é¡µé¢æ˜¾ç¤ºåŠ è½½æç¤º

2. **é”™è¯¯å¤„ç†**:
   - å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   - åŒºåˆ†ä¸åŒé”™è¯¯ç±»å‹
   - è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆé”å®šåœºæ™¯ï¼‰

3. **æ•°æ®æŒä¹…åŒ–**:
   - è®¤è¯ä¿¡æ¯localStorageæŒä¹…åŒ–
   - è‰ç¨¿å†…å®¹å®æ—¶ç¼“å­˜
   - é˜²æ­¢æ„å¤–æ•°æ®ä¸¢å¤±

4. **è¿”å›åœ°å€ä¿ç•™**:
   - æœªç™»å½•è®¿é—®å—ä¿æŠ¤é¡µé¢
   - ç™»å½•åè‡ªåŠ¨è¿”å›åŸé¡µé¢
   - ä½¿ç”¨`?return=`å‚æ•°å®ç°

---

## APIé€šä¿¡è§„èŒƒ

### è¯·æ±‚æ ¼å¼

**é€šç”¨è¯·æ±‚å¤´**:
```
Content-Type: application/json
Authorization: Bearer {token}
```

**åŸºç¡€URL**:
- ç¯å¢ƒå˜é‡ï¼š`VITE_API_BASE_URL`
- ç”Ÿäº§åŸŸåï¼š`https://api.after-word.org`ï¼ˆå½“hostnameåŒ…å«after-word.orgæ—¶ï¼‰
- å¼€å‘é»˜è®¤ï¼šç©ºå­—ç¬¦ä¸²ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰

### å“åº”æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "ok": true,
  ...å…¶ä»–æ•°æ®å­—æ®µ
}
```

**é”™è¯¯å“åº”**:
```json
{
  "code": "error_code",
  "message": "Human readable error message"
}
```

### é”™è¯¯ç 

| Code | HTTP Status | è¯´æ˜ | å‰ç«¯å¤„ç† |
|------|-------------|------|----------|
| unauthorized | 401 | æœªè®¤è¯æˆ–ä¼šè¯è¿‡æœŸ | æ¸…é™¤ä¼šè¯ï¼Œè·³è½¬ç™»å½• |
| not_found | 404 | èµ„æºä¸å­˜åœ¨ | æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ |
| locked | 423 | èµ„æºè¢«é”å®š | è¿›å…¥åªè¯»æ¨¡å¼ï¼Œè‡ªåŠ¨é‡è¯• |
| validation_failed | 400 | éªŒè¯å¤±è´¥ | æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ |
| suggestions_not_processed | 400 | æœ‰æœªå¤„ç†çš„å»ºè®® | æ˜¾ç¤ºæœªå¤„ç†æ•°é‡ï¼Œé˜»æ­¢æäº¤ |
| llm_failed | 500 | AIåˆ†æå¤±è´¥ | æç¤ºç¨åé‡è¯• |
| rate_limit_exceeded | 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | æç¤ºç­‰å¾…åé‡è¯• |

---

## æœªæ¥æ‰©å±•ç‚¹

### å¾…å®ç°é¡µé¢
- `/why` - äº§å“ä»‹ç»é¡µ
- `/about` - å…³äºé¡µé¢

### å¯èƒ½çš„åŠŸèƒ½å¢å¼º
- ä½œå“æ ‡é¢˜ç¼–è¾‘
- ä½œå“æ ‡ç­¾/åˆ†ç±»
- æœç´¢å’Œè¿‡æ»¤
- åˆ†äº«åŠŸèƒ½
- åä½œç¼–è¾‘
- è¯„è®ºåŠŸèƒ½
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF, DOCXç­‰ï¼‰
- æš—è‰²ä¸»é¢˜

---

## å¼€å‘è°ƒè¯•

### ç¯å¢ƒå˜é‡
```
VITE_API_BASE_URL=http://localhost:8000  # æœ¬åœ°åç«¯APIåœ°å€
```

### æœ¬åœ°å¼€å‘
```bash
cd frontend
npm install
npm run dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
npm run build
```

### è°ƒè¯•æŠ€å·§
1. æŸ¥çœ‹localStorage: æ£€æŸ¥è®¤è¯tokenå’Œè‰ç¨¿ç¼“å­˜
2. ç½‘ç»œé¢æ¿: æŸ¥çœ‹APIè¯·æ±‚å’Œå“åº”
3. React DevTools: æŸ¥çœ‹ç»„ä»¶çŠ¶æ€å’Œprops
4. Console: æŸ¥çœ‹é”™è¯¯æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯

---

æ–‡æ¡£ç‰ˆæœ¬: 1.0
æœ€åæ›´æ–°: 2025-02-12
