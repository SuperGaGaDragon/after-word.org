# API端点文档 (2026-02-12)

本文档记录当前所有可用的API端点及其功能说明。

---

## 认证相关 (Auth)

### POST /api/auth/signup
用户注册接口，创建新账号并返回JWT token。

### POST /api/auth/login
用户登录接口，验证邮箱密码后返回JWT token。

### POST /api/auth/change_password
修改当前用户的密码，需要提供旧密码和新密码。

### POST /api/auth/change_username
修改当前用户的用户名。

### GET /api/auth/me
获取当前登录用户的信息（邮箱、用户名）。

---

## 作品管理 (Work)

### POST /api/work/create
创建一个新的空白作品，返回作品ID。

### GET /api/work/list
获取当前用户的所有作品列表，包含创建时间、修改时间和字数统计。

### GET /api/work/{work_id}
获取指定作品的详细信息，包含完整内容、版本号、时间戳和字数。

### POST /api/work/{work_id}/update
更新作品内容，可选择是否创建新的草稿版本，自动计算并更新字数。

### POST /api/work/{work_id}/submit
提交作品进行AI评价，创建提交版本并触发AI分析。

### DELETE /api/work/{work_id}
删除指定作品，同时级联删除所有相关的版本、分析和建议记录。

---

## 版本管理 (Version)

### GET /api/work/{work_id}/versions
获取指定作品的版本历史列表，可按类型（全部/草稿/提交）筛选。

### GET /api/work/{work_id}/versions/{version_number}
获取指定版本的详细内容和AI分析结果（如果有）。

### POST /api/work/{work_id}/revert
将作品回退到指定历史版本，创建新的草稿版本保存回退内容。

---

## LLM相关 (AI评价)

### POST /api/llm/comment
生成简单的AI评论（遗留接口），用于快速获取文本反馈。

---

## 对话管理 (Conversation)

### POST /api/conversation/{work_id}/list
获取指定作品的对话历史记录。

### POST /api/conversation/add
向作品添加新的对话消息。

---

## 认证方式

所有需要认证的接口使用 **JWT Bearer Token** 认证：

```
Authorization: Bearer {token}
```

Token在登录或注册成功后返回，需要在后续请求的Header中携带。

---

## 数据字段说明

### 时间字段
- `created_at`: 作品创建时间（ISO 8601格式）
- `updated_at`: 作品最后修改时间（ISO 8601格式）

### 字数统计
- `word_count`: 自动计算的字数，英文按单词统计，中文按字符统计

### 版本管理
- `current_version`: 作品当前版本号
- `is_submitted`: 标识版本是提交版本还是草稿版本
- `change_type`: 版本变更类型（submission/draft_edit/revert）

---

## 更新日志

### 2026-02-12
- ✅ 所有work相关接口新增 `created_at` 字段
- ✅ 所有work相关接口新增 `word_count` 字段（自动计算）
- ✅ 更新/提交作品时自动计算并保存字数
- ✅ 支持中英文混合文本的字数统计
- ✅ 新增 `essay_prompt` 字段，支持用户输入essay要求/题目
- ✅ AI评价时会根据用户提供的essay_prompt来评估是否符合要求
