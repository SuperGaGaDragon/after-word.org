# After Word - 功能设计文档

## 产品定位

After Word 是一个AI驱动的文书写作辅助平台，帮助学生通过迭代式反馈改进essay写作。

---

## 核心功能

### 1. 作品管理

用户可以创建、编辑、查看、删除自己的essays（称为works）。

**基本操作**：
- 创建新work
- 编辑work内容
- 查看work列表
- 查看单个work详情
- 删除work

**特性**：
- 每个work独立存在
- 支持多设备编辑（通过锁机制防冲突）

---

### 2. 版本系统

作品有两种版本：**提交版本**和**草稿版本**。

#### 2.1 提交版本 (Submitted Version)

- 用户点击"提交"按钮产生
- 永久保存，不会被删除
- 每次提交触发完整的AI评价
- 用户可以回看任何历史提交版本

**用途**：记录重要的版本里程碑

#### 2.2 草稿版本 (Draft Version)

- 用户编辑过程中自动保存（每3秒或停止输入后）
- 下次提交时，之前的草稿版本全部清理
- 提供"进度条式"的编辑历史回放

**用途**：保存编辑进度，支持撤销/回滚

#### 2.3 版本回滚

用户可以回滚到任何历史版本：
- 回滚到某个提交版本
- 回滚到某个草稿版本（当前提交周期内）

回滚不会删除历史，而是创建新的草稿版本。

---

### 3. AI评价系统

每次用户提交作品，系统生成三类AI评价。

#### 3.1 FAO Comment（整体评价）

**全称**：First/Overall Assessment Comment

**内容**：
- 对整篇essay的宏观评价
- 关注整体结构、逻辑、主题
- 指出主要优点和问题

**语言**：英文

**特点**：第一次及后续提交都会生成新的FAO comment

---

#### 3.2 Sentence Comments（句子级建议）

**内容**：
- 精确到句子/段落的具体问题
- 标注问题位置（字符索引）
- 问题分类：语法/表达/风格/语气/逻辑/冗余
- 严重程度：高/中/低
- 改进建议（不提供重写版本）

**语言**：英文

**问题类型**：
- Grammar - 语法错误
- Clarity - 表达不清
- Style - 风格问题
- Tone - 语气不当
- Logic - 逻辑问题
- Conciseness - 冗余啰嗦

**第一次提交**：
- 纯建议，指出问题和改进方向

**第二次及以后提交**：
- 对上次标记"改进完成"的问题，评价改进效果：
  - Excellent: 改进非常好
  - Partial: 有改进但不够
  - Unsolved: 完全没改进
  - New Issue: 出现新问题
- 同时发现新的问题

---

#### 3.3 Reflection Comment（反思评价）

**触发条件**：只有当用户上次提交时写了reflection（修改思路说明）才会出现

**内容**：
- 评价用户的修改思路是否合理
- 评价思路和实际改进的匹配度
- 指出思路中的盲点或误区

**语言**：英文

---

### 4. 用户反馈系统

用户在收到AI评价后，需要对每个建议做出响应。

#### 4.1 对Sentence Comment的响应

**强制要求**：用户必须处理所有sentence comments才能进行下次提交

**响应选项**：
1. **改进完成 (Resolved)**：
   - 用户认为已经改进了这个问题
   - 可选填写100字以内的改进说明（解释如何改的、为什么这样改）

2. **拒绝 (Rejected)**：
   - 用户不同意这个建议，选择不改

#### 4.2 对FAO Comment的响应

**可选**：用户可以写reflection（修改思路说明）

**内容**：
- 针对FAO comment的改进计划
- 说明对哪些建议的理解和改进方式
- 不需要涉及sentence comments的细节

**作用**：
- 帮助用户梳理思路
- 下次提交时LLM会根据reflection生成reflection comment

---

### 5. 迭代改进流程

完整的改进流程：

```
第一次提交
  ↓
生成：FAO Comment + Sentence Comments
  ↓
用户标记每个Sentence Comment（改进完成/拒绝）
用户可选写Reflection
  ↓
用户修改essay
  ↓
第二次提交
  ↓
生成：
- 新的Sentence Comments（包含对上次改进的评价）
- 新的FAO Comment
- Reflection Comment（如果上次有reflection）
  ↓
用户继续标记和修改
  ↓
循环...
```

**关键特性**：
- 迭代式改进，每次基于上次反馈
- AI会追踪改进情况，不会重复提同样的问题（如果已改好）
- 用户可以看到自己的进步轨迹

---

### 6. AI特性

#### 6.1 Persona（角色设定）

AI扮演"严格但公正的招生官"：
- 标准很高，不轻易满意
- 非常严厉，指出问题毫不留情
- 但绝对客观公正
- 当学生确实做得好时，会给出克制但明确的表扬

#### 6.2 评价标准

- 对语法、表达等基础问题零容忍
- 对逻辑、论证要求严格
- 不轻易给"excellent"评价
- 即使部分改进也会指出不足

#### 6.3 上下文限制

- 每次分析限制750字以内
- 如果全文超过750字，用户需要选择要分析的段落
- 或分多次提交分析

---

### 7. 协作特性

#### 7.1 多设备编辑

- 同一work可以在多个设备编辑
- 通过锁机制防止冲突
- 一个设备编辑时，其他设备只读

#### 7.2 编辑锁

- 获取编辑权需要device_id
- 编辑时自动续锁
- 超时自动释放（5分钟）

---

## 数据关系

```
User
  ├─ Works (多个)
      ├─ Current Content (当前内容)
      ├─ Current Version Number
      ├─ Work Versions (版本历史)
      │   ├─ Submitted Versions (提交版本)
      │   └─ Draft Versions (草稿版本)
      ├─ Text Analyses (AI分析结果)
      │   ├─ FAO Comment
      │   ├─ Sentence Comments
      │   └─ Reflection Comment
      └─ Suggestion Resolutions (用户对建议的处理记录)
```

---

## 用户体验流程

### 典型使用场景

**第一轮改进**：
1. 学生创建新work
2. 写完初稿
3. 点击"提交"
4. 查看AI评价（FAO + Sentence Comments）
5. 逐一处理Sentence Comments
6. 针对FAO Comment写reflection
7. 修改essay
8. 再次提交

**第二轮改进**：
1. 查看新的评价
2. 看到上次改进的评价：
   - "这句改得很好"
   - "这里还有问题"
3. 看到Reflection Comment（AI评价你的思路）
4. 继续改进
5. 再次提交

**重复N轮，直到满意**

---

## 功能边界

### 包含的功能
- ✅ 作品管理（增删改查）
- ✅ 版本控制（提交版本+草稿版本）
- ✅ AI评价（FAO + Sentence + Reflection）
- ✅ 用户反馈追踪
- ✅ 迭代改进流程

### 不包含的功能
- ❌ 用户间协作（多人编辑同一作品）
- ❌ 评论区（用户间讨论）
- ❌ 分享功能
- ❌ 导出PDF等格式
- ❌ 语法检查器（独立于AI评价）
- ❌ 抄袭检测

---

## 语言策略

- **AI评价内容**：全部英文（面向全球学生）
- **API字段名**：英文
- **前端界面**：英文
- **开发讨论**：中文
